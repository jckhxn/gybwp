import{o as w,e as P,r as s,ca as S,F as _,cM as E,a9 as M,cN as k,cO as x,cP as R,ak as F,cQ as I,bB as v,cL as O,cR as U,cI as $,V as j}from"./sanity-DWTzRZb4.js";function y(u){return w(function(t,a){var i=!1,n=0;t.subscribe(P(a,function(r){return(i||(i=!u(r,n++)))&&a.next(r)}))})}const D=u=>{const{comlink:t,refs:a,perspective:i}=u,n=S(),r=_(),p=s.useMemo(()=>new E,[]),l=s.useMemo(()=>p.asObservable().pipe(M(b=>x(b.map(e=>{const f={...e,_id:R(e._id)},m=i==="published"?F:n.observeForPreview(f,r.get(f._type)).pipe(I(),y(o=>o.snapshot===null)),h={...e,_id:v(e._id)},g=n.observeForPreview(h,r.get(h._type));return O(g.pipe(U(m)),m).pipe($(o=>!!o.snapshot),j(o=>{const c=o.snapshot;return{_id:v(c._id),title:c.title,subtitle:c.subtitle,description:c.description,imageUrl:c.imageUrl}}))}))),k(0)),[n,p,r,i]),d=s.useRef([]);return s.useEffect(()=>{const b=l.subscribe(e=>{t.post("presentation/preview-snapshots",{snapshots:e}),d.current=e});return()=>{b.unsubscribe()}},[t,l]),s.useEffect(()=>t.on("visual-editing/preview-snapshots",()=>({snapshots:d.current})),[t]),s.useEffect(()=>{p.next(a)},[a,p]),null};var N=s.memo(D);export{N as default};
